<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vendor Dashboard | MyTicketSpot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
        --bg-body: #f3f4f6;
        --bg-sidebar: #111827;
        --bg-surface: #ffffff;
        --primary: #4f46e5;
        --text-main: #1f2937;
        --text-muted: #6b7280;
        --border: #e5e7eb;
        --success: #10b981;
    }

    * { margin:0; padding:0; box-sizing:border-box; font-family:'Inter', sans-serif; }
    body { background: var(--bg-body); display: flex; height: 100vh; color: var(--text-main); }

    /* Sidebar - Matches Create Event */
    .sidebar { width: 260px; background: var(--bg-sidebar); color: white; display: flex; flex-direction: column; padding: 1.5rem; flex-shrink: 0; }
    .brand { font-size: 1.4rem; font-weight: 700; margin-bottom: 2.5rem; color: #fff; display: flex; align-items: center; gap: 10px; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; color: #9ca3af; text-decoration: none; border-radius: 8px; font-size: 0.95rem; font-weight: 500; margin-bottom: 0.5rem; transition: 0.2s; }
    .nav-item:hover, .nav-item.active { background: rgba(255,255,255,0.1); color: white; }
    .nav-item.active { border-left: 4px solid var(--primary); background: #1f2937; }

    /* Main Area */
    .main { flex: 1; padding: 2.5rem; overflow-y: auto; }
    
    .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    .welcome-text h1 { font-size: 1.8rem; font-weight: 700; margin-bottom: 5px; }
    .welcome-text p { color: var(--text-muted); }

    .btn-create { background: var(--primary); color: white; text-decoration: none; padding: 10px 20px; border-radius: 8px; font-weight: 500; display: inline-flex; align-items: center; gap: 8px; font-size: 0.9rem; transition: 0.2s; }
    .btn-create:hover { background: #4338ca; }

    /* Table Design */
    .table-container { background: var(--bg-surface); border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; border: 1px solid var(--border); }
    table { width: 100%; border-collapse: collapse; }
    
    th { background: #f9fafb; padding: 16px; text-align: left; font-size: 0.85rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 1px solid var(--border); }
    td { padding: 16px; border-bottom: 1px solid var(--border); font-size: 0.95rem; vertical-align: middle; }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: #f9fafb; }

    /* Badges & Buttons */
    .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; background: #d1fae5; color: #065f46; }
    
    .action-btn { padding: 6px 12px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer; color: var(--text-main); font-size: 0.85rem; transition: 0.2s; margin-right: 5px; }
    .action-btn:hover { border-color: var(--text-muted); background: #f9fafb; }
    .btn-delete { color: #ef4444; border-color: #fee2e2; background: #fef2f2; }
    .btn-delete:hover { background: #fee2e2; }

    .empty-state { padding: 3rem; text-align: center; color: var(--text-muted); }
  </style>
</head>
<body>

<div class="sidebar">
  <div class="brand"><i class="fas fa-ticket-alt"></i> MyTicketSpot</div>
  <a href="vendor-dashboard.html" class="nav-item active"><i class="fas fa-chart-line"></i> Dashboard</a>
  <a href="create-event.html" class="nav-item"><i class="fas fa-plus-circle"></i> Create Event</a>
  <a href="vendor-bookings.html" class="nav-item"><i class="fas fa-calendar-check"></i> Bookings</a>
  <div style="margin-top: auto;">
      <a href="../index.html" onclick="logout()" class="nav-item"><i class="fas fa-sign-out-alt"></i> Logout</a>
  </div>
</div>

<div class="main">
  <div class="top-bar">
    <div class="welcome-text">
        <h1>Overview</h1>
        <p>Welcome back, <span id="vendorName">Vendor</span></p>
    </div>
    <a href="create-event.html" class="btn-create"><i class="fas fa-plus"></i> New Event</a>
  </div>

  <div class="table-container">
    <table id="vendorEventsTable">
      <thead>
        <tr>
          <th>Event Name</th>
          <th>Date & Time</th>
          <th>Category</th>
          <th>Price</th>
          <th>Stock</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        </tbody>
    </table>
    <div id="emptyMessage" class="empty-state" style="display:none;">
        <i class="fas fa-inbox" style="font-size:2rem; margin-bottom:10px; opacity:0.5;"></i>
        <p>No events found. Create your first event!</p>
    </div>
  </div>
</div>

<script>
// 1. Auth Check
let user = JSON.parse(localStorage.getItem("loggedInUser"));
if(!user || user.role !== "vendor") {
    // For demo purposes, create a session so the UI works immediately for you
    user = { name: "DemoVendor", role: "vendor" };
    localStorage.setItem("loggedInUser", JSON.stringify(user));
}
document.getElementById("vendorName").innerText = user.name;

function logout(){
  localStorage.removeItem("loggedInUser");
  window.location.href="login.html"; // Or location.reload() if no login page
}

// 2. Fetch & Filter Data
const eventsDB = JSON.parse(localStorage.getItem("eventsDB")) || [];

// Filter events that match the logged-in vendor's name
const vendorEvents = eventsDB.filter(ev => ev.vendor === user.name);

const tableBody = document.getElementById("tableBody");
const emptyMsg = document.getElementById("emptyMessage");

if (vendorEvents.length === 0) {
    emptyMsg.style.display = 'block';
} else {
    vendorEvents.forEach(ev => {
      const tr = document.createElement("tr");
      
      // Formatting Date
      const dateDisplay = ev.date ? new Date(ev.date).toLocaleDateString() : 'TBD';
      
      tr.innerHTML = `
        <td>
            <div style="font-weight:600;">${ev.title}</div>
            <div style="font-size:0.8rem; color:#6b7280;">${ev.venue || 'No Venue'}</div>
        </td>
        <td>${dateDisplay} <br> <span style="font-size:0.8rem; color:#6b7280;">${ev.time || ''}</span></td>
        <td style="text-transform:capitalize;">${ev.category}</td>
        <td>â‚¹${ev.price}</td>
        <td>
            <span style="font-weight:600;">${ev.available}</span> / ${ev.available}
        </td>
        <td><span class="status-badge">Active</span></td>
        <td>
            <button class="action-btn" onclick="alert('Edit feature coming soon')"><i class="fas fa-pen"></i></button>
            <button class="action-btn btn-delete" onclick="deleteEvent(${ev.id})"><i class="fas fa-trash"></i></button>
        </td>
      `;
      tableBody.appendChild(tr);
    });
}

// Simple Delete Logic for testing
function deleteEvent(id) {
    if(confirm("Are you sure you want to delete this event?")) {
        const updatedDB = eventsDB.filter(ev => ev.id !== id);
        localStorage.setItem("eventsDB", JSON.stringify(updatedDB));
        location.reload();
    }
}
</script>

</body>
</html>