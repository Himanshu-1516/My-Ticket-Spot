<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies | MyTicketSpot</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #E23744;
            --primary-dark: #c12733;
            --dark: #111827;
            --text-main: #1f2937;
            --text-muted: #6b7280;
            --bg: #f9fafb;
            --surface: #ffffff;
            --border: #f1f5f9;
            --radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--bg); color: var(--text-main); line-height: 1.5; }
        .hidden { display: none !important; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 6%; }

        /* --- Professional Header --- */
        header { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px);
            padding: 0 6%; 
            height: 72px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border); 
            position: fixed; 
            width: 100%;
            top: 0; 
            z-index: 1000; 
        }
        .logo { font-size: 1.25rem; font-weight: 800; display: flex; align-items: center; gap: 8px; letter-spacing: -0.5px; } 
        .logo span { color: var(--primary); }
        
        nav { display: flex; gap: 24px; }
        nav a { text-decoration: none; color: var(--text-muted); font-weight: 500; font-size: 0.9rem; transition: 0.2s; }
        nav a:hover, nav a.active { color: var(--primary); }

        /* --- Movie Grid (View 1) --- */
        .section-padding { padding: 110px 0 60px; }
        
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 24px; }
        
        .movie-card { 
            cursor: pointer; 
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .movie-card:hover { transform: translateY(-8px); }
        
        .poster-container { 
            position: relative; 
            border-radius: var(--radius); 
            overflow: hidden; 
            aspect-ratio: 2/3;
            background: #e5e7eb; 
            box-shadow: var(--shadow);
            margin-bottom: 12px;
        }
        .poster-container img { width: 100%; height: 100%; object-fit: cover; }
        
        .rating-overlay { 
            position: absolute; bottom: 0; width: 100%; 
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); 
            color: white; padding: 15px 12px 8px; font-size: 0.75rem;
            display: flex; align-items: center; gap: 6px;
            font-weight: 600;
        }
        
        .movie-card h3 { font-size: 0.95rem; font-weight: 700; color: var(--dark); margin-bottom: 2px; }
        .movie-card p { color: var(--text-muted); font-size: 0.8rem; }

        /* --- Details Hero (View 2) --- */
        .details-view { padding-top: 72px; }
        .nav-breadcrumb { background: #fff; padding: 14px 0; border-bottom: 1px solid var(--border); }
        .back-to-movies { color: var(--text-muted); text-decoration: none; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: 500; }

        .hero-banner { 
            min-height: 480px;
            background-size: cover; background-position: center;
            position: relative; color: white; padding: 60px 0;
            display: flex; align-items: center;
        }
        .hero-banner::before {
            content: ""; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(90deg, #0f172a 10%, rgba(15, 23, 42, 0.8) 50%, rgba(15, 23, 42, 0.4) 100%);
        }
        .hero-flex { position: relative; z-index: 2; display: flex; gap: 50px; align-items: center; }
        .hero-poster { width: 280px; aspect-ratio: 2/3; object-fit: cover; border-radius: 12px; box-shadow: var(--shadow-lg); }
        
        .hero-info h1 { font-size: 3rem; margin-bottom: 10px; font-weight: 800; letter-spacing: -1px; }
        
        .interested-strip { 
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); 
            padding: 16px 24px; border-radius: 12px; 
            display: flex; align-items: center; gap: 15px; margin: 24px 0; width: fit-content;
            border-left: 4px solid var(--primary);
        }
        
        .badge-row { display: flex; gap: 8px; margin: 20px 0; }
        .badge { background: rgba(255,255,255,0.15); padding: 6px 14px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
        
        .about-section { margin: 30px 0; max-width: 650px; }
        .about-section h4 { font-size: 1.1rem; margin-bottom: 10px; color: #fff; }
        .about-section p { font-size: 0.95rem; line-height: 1.7; color: #cbd5e1; }

        .btn-book-now { 
            background: var(--primary); color: white; border: none; 
            padding: 18px 50px; border-radius: 12px; font-weight: 700; 
            cursor: pointer; font-size: 1rem; transition: 0.3s;
            box-shadow: 0 10px 15px -3px rgba(226, 55, 68, 0.3);
        }
        .btn-book-now:hover { background: var(--primary-dark); transform: scale(1.02); }

        /* --- Showtimes (View 3) --- */
        .booking-nav { background: white; border-bottom: 1px solid var(--border); padding: 30px 0; position: sticky; top: 72px; z-index: 900; }
        .date-row { display: flex; gap: 12px; margin-top: 20px; padding-bottom: 5px; overflow-x: auto; scrollbar-width: none; }
        .date-box { 
            min-width: 60px; height: 80px; border: 1px solid var(--border); border-radius: 12px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s;
            background: var(--bg);
        }
        .date-box.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        .filter-bar { display: flex; gap: 12px; padding: 20px 0; border-bottom: 1px solid var(--border); }
        .filter-select { padding: 10px 16px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.85rem; font-weight: 600; color: var(--text-main); cursor: pointer; background: white; }

        .cinema-card { background: white; margin-top: 24px; padding: 30px; border-radius: var(--radius); border: 1px solid var(--border); box-shadow: var(--shadow); }
        .cinema-name { font-weight: 800; margin-bottom: 24px; display: flex; align-items: center; gap: 10px; font-size: 1rem; }
        
        .time-grid { display: flex; flex-wrap: wrap; gap: 12px; }
        .time-pill { 
            border: 1px solid #10b981; color: #10b981; 
            padding: 12px 20px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; text-align: center; cursor: pointer;
            min-width: 110px; transition: 0.2s; background: white;
        }
        .time-pill:hover { background: #f0fdf4; }
        .time-pill.filling { border-color: #f59e0b; color: #f59e0b; }
        .time-pill span { display: block; font-size: 0.65rem; color: var(--text-muted); margin-top: 4px; font-weight: 500; }

        /* --- SEAT SELECTION VIEW (View 4) --- */
        .seat-selection-view {
            padding-top: 72px;
            background: #fff;
            min-height: 100vh;
        }

        .seat-selection-header {
            padding: 20px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .seat-movie-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .seat-language {
            font-size: 14px;
            color: var(--text-muted);
            font-weight: 500;
        }

        .seat-cinema-info {
            color: var(--text-muted);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
        }

        .seat-cinema-info i {
            font-size: 12px;
        }

        .time-slots-row {
            display: flex;
            overflow-x: auto;
            gap: 16px;
            padding: 20px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #f1f5f9;
        }

        .time-slot {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-main);
            background: white;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .time-slot:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .time-slot.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Seat Selection Container */
        .seat-selection-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .seat-categories {
            margin-bottom: 30px;
        }

        .seat-category {
            margin-bottom: 40px;
        }

        .seat-category-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .seat-category-price {
            color: var(--primary);
            font-weight: 600;
            background: #fef2f2;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 16px;
        }

        .seats-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .seats-table th {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-align: center;
            padding: 8px 4px;
            width: 30px;
        }

        .seats-table td {
            text-align: center;
            padding: 4px;
        }

        .row-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
            padding-right: 15px;
            text-align: right;
        }

        .seat {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            margin: 0 auto;
        }

        /* Seat Status */
        .seat.available {
            background: #dcfce7;
            color: #166534;
            border-color: #22c55e;
        }

        .seat.available:hover {
            background: #bbf7d0;
            transform: scale(1.05);
        }

        .seat.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .seat.sold {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #d1d5db;
        }

        .seat.bestseller {
            background: #fef3c7;
            color: #92400e;
            border-color: #f59e0b;
        }

        /* Screen */
        .screen-container {
            text-align: center;
            margin: 40px 0 20px;
            position: relative;
        }

        .screen-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .screen {
            width: 90%;
            height: 8px;
            background: linear-gradient(90deg, #4b5563, #1f2937, #4b5563);
            margin: 0 auto;
            border-radius: 4px;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .screen:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            border-radius: 4px;
        }

        /* Legend */
        .seat-legend {
            display: flex;
            gap: 25px;
            margin: 30px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-main);
            font-weight: 500;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .legend-icon.bestseller {
            background: #fef3c7;
            border: 1px solid #f59e0b;
        }

        .legend-icon.available {
            background: #dcfce7;
            border: 1px solid #22c55e;
        }

        .legend-icon.selected {
            background: var(--primary);
            border: 1px solid var(--primary);
        }

        .legend-icon.sold {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
        }

        /* Payment Bar */
        .payment-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .payment-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .selected-seats-info {
            font-size: 16px;
            color: var(--text-main);
        }

        .selected-count {
            font-weight: 700;
            color: var(--primary);
        }

        .total-price {
            font-size: 24px;
            font-weight: 800;
            color: var(--dark);
        }

        .btn-pay {
            background: var(--primary);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-pay:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(226, 55, 68, 0.3);
        }

        .btn-pay:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-top: 30px;
            font-size: 14px;
            color: var(--text-muted);
            border-top: 1px solid #e5e7eb;
        }

        .status-offer {
            color: var(--primary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-pagination {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .weather-info {
            color: var(--text-muted);
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .hero-flex { flex-direction: column; text-align: center; gap: 20px; }
            .hero-poster { width: 200px; }
            .interested-strip { margin: 20px auto; }
            .badge-row { justify-content: center; }
            .hero-info h1 { font-size: 2rem; }
            
            .seat-categories {
                flex-direction: column;
                gap: 30px;
            }
            
            .time-slots-row {
                gap: 10px;
            }
            
            .time-slot {
                padding: 6px 12px;
                font-size: 13px;
            }
            
            .seat {
                width: 24px;
                height: 24px;
                font-size: 10px;
            }
            
            .seats-table th {
                width: 24px;
                font-size: 10px;
            }
            
            .payment-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .seat-legend {
                gap: 15px;
                padding: 15px;
            }
            
            .screen {
                width: 95%;
                height: 6px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo"><i class="fa-solid fa-ticket-simple" style="color:var(--primary)"></i> MyTicket<span>Spot</span></div>
        <nav>
            <a href="index.html">Home</a>
            <a href="#" class="active">Comedy</a>
            <a href="liveevents.html">Events</a>
        </nav>
    </header>

    <main id="view-grid" class="container section-padding">
        <h2 style="margin-bottom: 32px; font-weight: 800; letter-spacing: -0.5px;">Recommended Movies</h2>
        <div class="movie-grid" id="grid-container"></div>
    </main>

    <main id="view-detail" class="hidden details-view">
        <div class="nav-breadcrumb">
            <div class="container">
                <div class="back-to-movies" onclick="showView('grid')">
                    <i class="fa-solid fa-chevron-left"></i> Back to Movies
                </div>
            </div>
        </div>

        <div class="hero-banner" id="hero-bg">
            <div class="container hero-flex">
                <img id="dt-poster" src="" class="hero-poster">
                <div class="hero-info">
                    <h1 id="dt-title">Movie Title</h1>
                    
                    <div class="interested-strip">
                        <i class="fa-solid fa-heart" style="color: var(--primary); font-size: 1.5rem;"></i>
                        <div>
                            <div style="font-weight: 800; font-size: 1.1rem;"><span id="dt-likes">0</span> are interested</div>
                            <div style="font-size: 0.75rem; opacity: 0.8; font-weight: 500;">Ratings will appear once reviews come in</div>
                        </div>
                    </div>

                    <div class="badge-row" id="dt-badges">
                        <span class="badge" id="dt-runtime">3h 19m</span>
                        <span class="badge" id="dt-genre">Action</span>
                        <span class="badge">UA 13+</span>
                        <span class="badge">Hindi, English</span>
                    </div>

                    <div class="about-section">
                        <h4>About the movie</h4>
                        <p id="dt-desc"></p>
                    </div>

                    <button class="btn-book-now" onclick="showView('booking')">Book tickets</button>
                </div>
            </div>
        </div>
    </main>

    <main id="view-booking" class="hidden details-view">
        <div class="booking-nav">
            <div class="container">
                <div class="back-to-movies" style="margin-bottom: 12px;" onclick="showView('detail')">
                    <i class="fa-solid fa-chevron-left"></i> Back to Movie Details
                </div>
                <h2 id="bk-title" style="font-size: 1.5rem; font-weight: 800; letter-spacing: -0.5px;">Movie Name</h2>
                <div class="date-row" id="date-slider"></div>
            </div>
        </div>

        <div class="container" style="padding-bottom: 80px;">
            <div class="filter-bar">
                <select class="filter-select" id="time-filter" onchange="filterShows()">
                    <option value="all">Filter: All Times</option>
                    <option value="morning">Morning (Before 12 PM)</option>
                    <option value="afternoon">Afternoon (12 PM - 4 PM)</option>
                    <option value="evening">Evening (4 PM - 8 PM)</option>
                    <option value="night">Night (After 8 PM)</option>
                </select>
                <select class="filter-select"><option>Price Range</option></select>
                <select class="filter-select"><option>Show Format</option></select>
            </div>

            <div id="cinema-list"></div>
        </div>
    </main>

    <!-- SEAT SELECTION VIEW -->
    <main id="view-seats" class="hidden seat-selection-view">
        <div class="seat-selection-header">
            <div class="container">
                <div class="back-to-movies" style="margin-bottom: 12px;" onclick="showView('booking')">
                    <i class="fa-solid fa-chevron-left"></i> Back to Showtimes
                </div>
                <h1 class="seat-movie-title" id="seat-movie-title">Border 2 <span class="seat-language">- (Hindi)</span></h1>
                <div class="seat-cinema-info">
                    <i class="fa-solid fa-location-dot"></i>
                    <span id="seat-cinema-name">Miraj Cinemas: TGIP, Noida</span>
                    <i class="fa-solid fa-circle" style="font-size: 4px;"></i>
                    <span id="seat-show-date">Thu, 05 February, 2026</span>
                    <i class="fa-solid fa-circle" style="font-size: 4px;"></i>
                    <span id="seat-show-time">11:00 PM</span>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Time Slots -->
            <div class="time-slots-row" id="time-slots-row">
                <!-- Time slots will be dynamically generated -->
            </div>

            <!-- Seat Selection Container -->
            <div class="seat-selection-container">
                <!-- Recliner Seats (Top Section) -->
                <div class="seat-category">
                    <h3 class="seat-category-title">RECLINER <span class="seat-category-price">₹300</span></h3>
                    <div id="recliner-seats">
                        <!-- Recliner seats will be dynamically generated -->
                    </div>
                </div>

                <!-- Gold Seats (Bottom Section) -->
                <div class="seat-category">
                    <h3 class="seat-category-title">GOLD <span class="seat-category-price">₹150</span></h3>
                    <div id="gold-seats">
                        <!-- Gold seats will be dynamically generated -->
                    </div>
                </div>

                <!-- Screen Below Gold Seats Only -->
                <div class="screen-container">
                    <div class="screen-label">SCREEN THIS WAY</div>
                    <div class="screen"></div>
                </div>

                <!-- Legend -->
                <div class="seat-legend">
                    <div class="legend-item">
                        <div class="legend-icon bestseller"></div>
                        <span>Bestseller</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon available"></div>
                        <span>Available</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon selected"></div>
                        <span>Selected</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-icon sold"></div>
                        <span>Sold</span>
                    </div>
                </div>

                <!-- Status Bar -->
                <div class="status-bar">
                    <div class="status-offer">
                        <i class="fa-solid fa-check-circle"></i> YES Private Debit Card Offer
                    </div>
                    <div class="status-pagination">
                        <span>1/3</span>
                        <span>ENG 4:30 AM</span>
                        <span>IN 1/30/2026</span>
                        <span class="weather-info">16°C Mostly sunny</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Payment Bar -->
        <div class="payment-bar">
            <div class="payment-content">
                <div class="selected-seats-info">
                    Selected: <span class="selected-count" id="selected-count">0</span> seats
                </div>
                <div class="total-price">
                    ₹<span id="total-price">0</span>
                </div>
                <button class="btn-pay" id="pay-button" onclick="processPayment()" disabled>
                    Pay ₹<span id="pay-amount">0</span>
                </button>
            </div>
        </div>
    </main>

    <script>
        // 1. DATA MERGING (Static + Vendor)
        const staticMovies = [
            { 
                id: 1, 
                title: "Border 2", 
                genre: "Action/Drama/War", 
                rating: "299K Likes", 
                img: "https://assets-in.bmscdn.com/iedb/movies/images/mobile/thumbnail/xlarge/border-2-et00401449-1768546422.jpg", 
                desc: "A historic war epic bringing the saga of the Indian Armed Forces to the big screen. Witness a new generation of warriors defending the nation.", 
                likes: "150k+", 
                runtime: "3h 19m" 
            },
            { 
                id: 2, 
                title: "Dhurandhar", 
                genre: "Action/Thriller", 
                rating: "9.3/10", 
                img: "https://assets-in.bmscdn.com/discovery-catalog/events/tr:w-400,h-600,bg-CCCCCC:w-400.0,h-660.0,cm-pad_resize,bg-000000,fo-top:l-image,i-discovery-catalog@@icons@@star-icon-202203010609.png,lx-24,ly-615,w-29,l-end:l-text,ie-OS4zLzEwICA1MzNLKyBWb3Rlcw%3D%3D,fs-29,co-FFFFFF,ly-612,lx-70,pa-8_0_0_0,l-end/et00452447-smmrnuhqrx-portrait.jpg", 
                desc: "A high-octane thriller filled with suspense and intense action sequences that will keep you on the edge of your seat.", 
                likes: "120k+", 
                runtime: "2h 45m" 
            }
        ];

        const vendorData = JSON.parse(localStorage.getItem('eventsDB')) || JSON.parse(localStorage.getItem('nexus_events_db')) || [];
        const dynamicMovies = vendorData.filter(e => e.category === 'movies' || e.vendorCategory === 'movies').map(e => ({
            id: e.id,
            title: e.title || e.name,
            genre: e.genre || "Action/Drama",
            rating: e.rating || "New Release",
            img: e.img,
            desc: e.desc || "Experience this incredible new release on the big screen with immersive sound and high-quality visuals.",
            likes: e.rating || "100k+",
            runtime: "2h 30m"
        }));

        const allMovies = [...staticMovies, ...dynamicMovies];

        // Seat Selection Data
        const currentSeatSelection = {
            movieId: null,
            cinema: "",
            date: "",
            time: "",
            selectedSeats: [],
            reclinerPrice: 300,
            goldPrice: 150
        };

        // Time slots for different shows
        const timeSlots = [
            "09:00 AM", "10:00 AM", "11:00 AM", "01:00 PM", "02:00 PM", 
            "03:00 PM", "05:00 PM", "06:00 PM", "07:00 PM", "09:00 PM", 
            "10:00 PM", "11:00 PM"
        ];

        // 2. CORE FUNCTIONS
        function showView(viewId) {
            ['view-grid', 'view-detail', 'view-booking', 'view-seats'].forEach(v => {
                document.getElementById(v).classList.add('hidden');
            });
            document.getElementById('view-' + viewId).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function renderGrid() {
            const container = document.getElementById('grid-container');
            
            container.innerHTML = allMovies.slice(0, 4).map(m => `
                <div class="movie-card" onclick="openDetail(${m.id})">
                    <div class="poster-container">
                        <img src="${m.img}" onerror="this.src='https://placehold.co/400x600?text=${encodeURIComponent(m.title)}'">
                        <div class="rating-overlay">
                            <i class="fa-solid fa-heart" style="color:var(--primary)"></i> <span>${m.likes}</span>
                        </div>
                    </div>
                    <h3>${m.title}</h3>
                    <p>${m.genre}</p>
                </div>
            `).join('');
        }

        function openDetail(id) {
            const movie = allMovies.find(m => m.id == id);
            document.getElementById('dt-title').innerText = movie.title;
            document.getElementById('dt-poster').src = movie.img;
            document.getElementById('dt-likes').innerText = movie.likes;
            document.getElementById('dt-genre').innerText = movie.genre;
            document.getElementById('dt-runtime').innerText = movie.runtime;
            document.getElementById('dt-desc').innerText = movie.desc;
            document.getElementById('bk-title').innerText = movie.title;
            
            const hero = document.getElementById('hero-bg');
            hero.style.backgroundImage = `url('${movie.img}')`;
            
            showView('detail');
        }

        function filterShows() {
            const timeVal = document.getElementById('time-filter').value;
            const container = document.getElementById('cinema-list');
            const cinemas = [
                { name: "PVR: Vegas Dwarka", shows: ["09:00 AM", "11:30 AM", "02:45 PM", "06:10 PM", "09:40 PM", "11:55 PM"] },
                { name: "Cinepolis: Pacific Mall", shows: ["10:15 AM", "01:00 PM", "04:30 PM", "08:00 PM", "10:50 PM"] },
                { name: "INOX: Janak Place", shows: ["09:30 AM", "12:15 PM", "03:30 PM", "07:00 PM", "09:15 PM"] },
                { name: "Miraj Cinemas: TGIP, Noida", shows: ["09:00 AM", "10:00 AM", "11:00 AM", "01:00 PM", "02:00 PM", "03:00 PM", "05:00 PM", "06:00 PM", "07:00 PM", "09:00 PM", "10:00 PM", "11:00 PM"] }
            ];

            container.innerHTML = cinemas.map(c => {
                const filtered = c.shows.filter(s => {
                    const hour = parseInt(s);
                    const isPM = s.includes("PM");
                    const realHour = (isPM && hour !== 12) ? hour + 12 : (!isPM && hour === 12 ? 0 : hour);

                    if(timeVal === 'morning') return realHour < 12;
                    if(timeVal === 'afternoon') return realHour >= 12 && realHour < 16;
                    if(timeVal === 'evening') return realHour >= 16 && realHour < 20;
                    if(timeVal === 'night') return realHour >= 20;
                    return true;
                });

                if(filtered.length === 0) return "";

                return `
                    <div class="cinema-card">
                        <div class="cinema-name"><i class="fa-regular fa-heart" style="color:#94a3b8"></i> ${c.name}</div>
                        <div class="time-grid">
                            ${filtered.map((s, idx) => `
                                <div class="time-pill ${idx % 3 === 0 ? 'filling' : ''}" onclick="openSeatSelection('${c.name}', '${s}')">
                                    ${s}
                                    <span>${idx % 2 === 0 ? '4K DOLBY' : 'IMAX 2D'}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function initDates() {
            const slider = document.getElementById('date-slider');
            const days = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"];
            const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
            let html = "";
            for(let i=0; i<7; i++) {
                let d = new Date();
                d.setDate(d.getDate() + i);
                html += `
                    <div class="date-box ${i===0 ? 'active' : ''}" onclick="selectDate(this)">
                        <span style="font-size:0.7rem; font-weight: 600; opacity:0.7;">${days[d.getDay()]}</span>
                        <b style="font-size:1.1rem; margin: 2px 0;">${d.getDate()}</b>
                        <span style="font-size:0.65rem; font-weight: 600;">${months[d.getMonth()]}</span>
                    </div>
                `;
            }
            slider.innerHTML = html;
        }

        function selectDate(el) {
            document.querySelectorAll('.date-box').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            filterShows();
        }

        // SEAT SELECTION FUNCTIONS
        function openSeatSelection(cinemaName, showTime) {
            const movieTitle = document.getElementById('bk-title').innerText;
            const selectedDate = document.querySelector('.date-box.active b').innerText;
            const selectedMonth = document.querySelector('.date-box.active span:nth-child(3)').innerText;
            
            // Set current selection data
            currentSeatSelection.cinema = cinemaName;
            currentSeatSelection.date = `${selectedDate} ${selectedMonth}, 2026`;
            currentSeatSelection.time = showTime;
            
            // Update UI
            document.getElementById('seat-movie-title').innerText = movieTitle;
            document.getElementById('seat-cinema-name').innerText = cinemaName;
            document.getElementById('seat-show-time').innerText = showTime;
            document.getElementById('seat-show-date').innerText = getFormattedDate();
            
            // Generate time slots
            generateTimeSlots();
            
            // Generate seats
            generateSeats();
            
            // Reset selection
            currentSeatSelection.selectedSeats = [];
            updatePaymentInfo();
            
            // Show seat selection view
            showView('seats');
        }

        function getFormattedDate() {
            const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
            const months = ["January", "February", "March", "April", "May", "June", 
                          "July", "August", "September", "October", "November", "December"];
            const d = new Date();
            const activeDate = document.querySelector('.date-box.active');
            if (activeDate) {
                const dayName = activeDate.querySelector('span:nth-child(1)').innerText;
                const dateNum = activeDate.querySelector('b').innerText;
                const monthName = activeDate.querySelector('span:nth-child(3)').innerText;
                const monthIndex = months.findIndex(m => m.substring(0, 3).toUpperCase() === monthName);
                const dayIndex = days.findIndex(day => day.toUpperCase() === dayName);
                
                return `${days[dayIndex]}, ${dateNum} ${months[monthIndex]}, 2026`;
            }
            return "Thu, 05 February, 2026";
        }

        function generateTimeSlots() {
            const container = document.getElementById('time-slots-row');
            container.innerHTML = timeSlots.map(time => `
                <div class="time-slot ${time === currentSeatSelection.time ? 'active' : ''}" 
                     onclick="changeShowTime('${time}')">
                    ${time}
                </div>
            `).join('');
        }

        function changeShowTime(time) {
            currentSeatSelection.time = time;
            document.getElementById('seat-show-time').innerText = time;
            
            // Update active time slot
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('active');
                if (slot.textContent.trim() === time) {
                    slot.classList.add('active');
                }
            });
            
            // Regenerate seats with new availability
            generateSeats();
        }

        function generateSeats() {
            // Generate recliner seats (Rows A-M, 12 seats per row)
            const reclinerContainer = document.getElementById('recliner-seats');
            const reclinerRows = ['A', 'B', 'C', 'D']
            
            // Create table for recliner seats
            let reclinerHTML = '<table class="seats-table">';
            
            // Create header row for seat numbers (1-12)
            reclinerHTML += '<thead><tr><th></th>';
            for (let i = 1; i <= 12; i++) {
                reclinerHTML += `<th>${i}</th>`;
            }
            reclinerHTML += '</tr></thead><tbody>';
            
            // Create seat rows
            reclinerRows.forEach(row => {
                reclinerHTML += '<tr>';
                reclinerHTML += `<td class="row-label">${row}</td>`;
                
                for (let i = 1; i <= 12; i++) {
                    const seatId = `R-${row}-${i}`;
                    const isSold = Math.random() < 0.3; // 30% chance of being sold
                    const isBestseller = (row === 'G' && i >= 4 && i <= 8) || (row === 'H' && i >= 4 && i <= 8);
                    
                    let seatClass = 'seat available';
                    if (isSold) seatClass = 'seat sold';
                    else if (isBestseller) seatClass = 'seat available bestseller';
                    
                    reclinerHTML += `
                        <td>
                            <div class="${seatClass}" 
                                 data-seat-id="${seatId}"
                                 data-seat-type="recliner"
                                 onclick="selectSeat('${seatId}', 'recliner', ${isSold})">
                                ${i <= 9 ? '0' + i : i}
                            </div>
                        </td>
                    `;
                }
                
                reclinerHTML += '</tr>';
            });
            
            reclinerHTML += '</tbody></table>';
            reclinerContainer.innerHTML = reclinerHTML;

            // Generate gold seats (Rows 01-13, 12 seats per row)
            const goldContainer = document.getElementById('gold-seats');
            const goldRows = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13'];
            
            // Create table for gold seats
            let goldHTML = '<table class="seats-table">';
            
            // Create header row for seat numbers (1-12)
            goldHTML += '<thead><tr><th></th>';
            for (let i = 1; i <= 12; i++) {
                goldHTML += `<th>${i}</th>`;
            }
            goldHTML += '</tr></thead><tbody>';
            
            // Create seat rows
            goldRows.forEach(row => {
                goldHTML += '<tr>';
                goldHTML += `<td class="row-label">${row}</td>`;
                
                for (let i = 1; i <= 12; i++) {
                    const seatId = `G-${row}-${i}`;
                    const isSold = Math.random() < 0.4; // 40% chance of being sold for gold seats
                    
                    let seatClass = 'seat available';
                    if (isSold) seatClass = 'seat sold';
                    
                    goldHTML += `
                        <td>
                            <div class="${seatClass}" 
                                 data-seat-id="${seatId}"
                                 data-seat-type="gold"
                                 onclick="selectSeat('${seatId}', 'gold', ${isSold})">
                                ${i <= 9 ? '0' + i : i}
                            </div>
                        </td>
                    `;
                }
                
                goldHTML += '</tr>';
            });
            
            goldHTML += '</tbody></table>';
            goldContainer.innerHTML = goldHTML;
        }

        function selectSeat(seatId, seatType, isSold) {
            if (isSold) return; // Can't select sold seats
            
            const seatElement = document.querySelector(`[data-seat-id="${seatId}"]`);
            const index = currentSeatSelection.selectedSeats.indexOf(seatId);
            
            if (index === -1) {
                // Select seat
                currentSeatSelection.selectedSeats.push(seatId);
                seatElement.classList.remove('available');
                seatElement.classList.add('selected');
                if (seatElement.classList.contains('bestseller')) {
                    seatElement.classList.remove('bestseller');
                }
            } else {
                // Deselect seat
                currentSeatSelection.selectedSeats.splice(index, 1);
                seatElement.classList.remove('selected');
                seatElement.classList.add('available');
                // Add back bestseller class if applicable
                const [type, row, num] = seatId.split('-');
                if (seatType === 'recliner' && (row === 'G' || row === 'H') && num >= 4 && num <= 8) {
                    seatElement.classList.add('bestseller');
                }
            }
            
            updatePaymentInfo();
        }

        function updatePaymentInfo() {
            const selectedCount = currentSeatSelection.selectedSeats.length;
            const reclinerSeats = currentSeatSelection.selectedSeats.filter(id => id.startsWith('R-')).length;
            const goldSeats = selectedCount - reclinerSeats;
            
            const totalPrice = (reclinerSeats * currentSeatSelection.reclinerPrice) + 
                             (goldSeats * currentSeatSelection.goldPrice);
            
            // Update UI
            document.getElementById('selected-count').innerText = selectedCount;
            document.getElementById('total-price').innerText = totalPrice;
            document.getElementById('pay-amount').innerText = totalPrice;
            
            // Enable/disable pay button
            const payButton = document.getElementById('pay-button');
            payButton.disabled = selectedCount === 0;
        }

        function processPayment() {
            if (currentSeatSelection.selectedSeats.length === 0) return;
            
            // Get seat details
            const reclinerSeats = currentSeatSelection.selectedSeats.filter(id => id.startsWith('R-')).length;
            const goldSeats = currentSeatSelection.selectedSeats.length - reclinerSeats;
            const totalPrice = (reclinerSeats * currentSeatSelection.reclinerPrice) + 
                             (goldSeats * currentSeatSelection.goldPrice);
            
            // Format seat numbers for display
            const seatNumbers = currentSeatSelection.selectedSeats.map(seatId => {
                const [type, row, num] = seatId.split('-');
                return `${row}${parseInt(num)}`;
            }).join(', ');
            
            // Get movie and show details
            const movieTitle = document.getElementById('seat-movie-title').textContent;
            const cinemaName = currentSeatSelection.cinema;
            const showDate = currentSeatSelection.date;
            const showTime = currentSeatSelection.time;
            
            // Generate a unique booking ID
            const bookingId = 'MTS-MOV-' + Date.now() + '-' + Math.floor(Math.random() * 1000);
            
            // Create booking object with COMPATIBLE KEYS
            const bookingDetails = {
                bookingId: bookingId,
                eventTitle: movieTitle, // Use 'eventTitle' to match guest-details.html
                movieTitle: movieTitle,
                venue: cinemaName, // Use 'venue' to match guest-details.html
                cinemaName: cinemaName,
                eventDate: showDate, // Use 'eventDate' to match guest-details.html
                showDate: showDate,
                eventTime: showTime, // Use 'eventTime' to match guest-details.html
                showTime: showTime,
                seats: seatNumbers, // Use 'seats' to match guest-details.html
                seatNumbers: seatNumbers,
                totalAmount: totalPrice, // Use 'totalAmount' to match guest-details.html
                totalPrice: totalPrice,
                bookingTime: new Date().toISOString(),
                ticketType: 'Movie Ticket',
                eventType: 'movie',
                reclinerSeats: reclinerSeats,
                goldSeats: goldSeats
            };
            
            // Save to localStorage with COMPATIBLE KEYS
            saveBookingToLocalStorage(bookingDetails);
            
            // Show payment confirmation modal
            const paymentConfirmed = confirm(
                `Payment Confirmation\n\n` +
                `Movie: ${movieTitle}\n` +
                `Cinema: ${cinemaName}\n` +
                `Date & Time: ${showDate}, ${showTime}\n` +
                `Selected Seats: ${seatNumbers}\n` +
                `Recliner Seats: ${reclinerSeats} x ₹${currentSeatSelection.reclinerPrice} = ₹${reclinerSeats * currentSeatSelection.reclinerPrice}\n` +
                `Gold Seats: ${goldSeats} x ₹${currentSeatSelection.goldPrice} = ₹${goldSeats * currentSeatSelection.goldPrice}\n` +
                `Total Amount: ₹${totalPrice}\n\n` +
                `Click OK to proceed to guest details.`
            );
            
            if (paymentConfirmed) {
                // Mark seats as sold
                currentSeatSelection.selectedSeats.forEach(seatId => {
                    const seatElement = document.querySelector(`[data-seat-id="${seatId}"]`);
                    if (seatElement) {
                        seatElement.classList.remove('selected');
                        seatElement.classList.add('sold');
                        seatElement.onclick = null; // Remove click event
                    }
                });
                
                // Reset selection
                currentSeatSelection.selectedSeats = [];
                updatePaymentInfo();
                
                // Redirect to guest-details.html with booking ID
                setTimeout(() => {
                    window.location.href = 'guest-details.html?bookingId=' + bookingId;
                }, 500);
            }
        }

        function saveBookingToLocalStorage(bookingDetails) {
            // Save as currentBooking (for guest-details.html compatibility)
            localStorage.setItem('currentBooking', JSON.stringify(bookingDetails));
            
            // Also save as currentMovieBooking for backward compatibility
            localStorage.setItem('currentMovieBooking', JSON.stringify(bookingDetails));
            
            // Get existing bookings or initialize empty array
            const existingBookings = JSON.parse(localStorage.getItem('movieBookings') || '[]');
            
            // Add new booking
            existingBookings.push(bookingDetails);
            
            // Save back to localStorage
            localStorage.setItem('movieBookings', JSON.stringify(existingBookings));
            
            // Save individual pieces for compatibility
            localStorage.setItem('bookingId', bookingDetails.bookingId);
            localStorage.setItem('eventName', bookingDetails.eventTitle);
            localStorage.setItem('eventType', 'movie');
            localStorage.setItem('totalPrice', bookingDetails.totalAmount);
            localStorage.setItem('seatNumbers', bookingDetails.seats);
            localStorage.setItem('cinemaName', bookingDetails.venue);
            localStorage.setItem('showDateTime', bookingDetails.showDate + ', ' + bookingDetails.showTime);
        }

        window.onload = () => {
            renderGrid();
            initDates();
            filterShows();
            
            // Initialize seat selection when page loads
            generateSeats();
        };
    </script>
</body>
</html>